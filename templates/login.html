<!DOCTYPE html>
<html>

<head>
    <title>WT Winds</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light d-flex justify-content-center align-items-center vh-100">

    <div class="card shadow p-4 text-center" style="width:420px">

        <h4>Sign in or Join</h4>
        <p class="text-muted">Enter your email to continue</p>

        <!-- FLASH MESSAGES -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% for category, msg in messages %}
        <div class="alert alert-{{category}} py-2">{{ msg }}</div>
        {% endfor %}
        {% endwith %}

        <!-- EMAIL FORM -->
        {% if step == "email" %}
        <form method="POST">
            <input type="hidden" name="action" value="send_otp">
            <input name="email" class="form-control my-3" placeholder="Email address" required>
            <button class="btn btn-primary w-100">Continue</button>
        </form>
        {% endif %}

        <!-- OTP UI SAME PAGE -->
        {% if step == "otp" %}
        <div class="small text-muted mb-2">
            We sent a code to <b>{{ session.email }}</b>
        </div>

        <form method="POST">
            <input type="hidden" name="action" value="verify_otp">
            <input name="otp" class="form-control text-center my-3" placeholder="Enter OTP" required>
            <button class="btn btn-primary w-100 mb-2">Verify</button>
        </form>

        <!-- RESEND + CHANGE -->
        <form method="POST">
            <input type="hidden" name="action" value="resend_otp">
            <button class="btn btn-link p-0">Resend OTP</button>
        </form>

        <a href="/change-email" class="text-muted small d-block mt-1">Change Email</a>
        {% endif %}

    </div>

</body>
<script>
    setTimeout(() => {
        document.querySelectorAll('.alert').forEach(el => {
            el.style.transition = "0.2s";
            el.style.opacity = "0";
            setTimeout(() => el.remove(), 500);
        });
    }, 5000);
</script>


</html>